(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{234:function(t,a,s){"use strict";s.r(a);var e=s(5),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域"}},[t._v("#")]),t._v(" 跨域")]),t._v(" "),s("h2",{attrs:{id:"什么是同源策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是同源策略"}},[t._v("#")]),t._v(" 什么是同源策略")]),t._v(" "),s("p",[t._v("端口号 协议 和域名 不一致，浏览器就会因为安全考虑，使用使用同源策略。")]),t._v(" "),s("h2",{attrs:{id:"jsonp-解决跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jsonp-解决跨域"}},[t._v("#")]),t._v(" jsonp 解决跨域")]),t._v(" "),s("p",[t._v("ajax 请求受同源策略影响，不允许进行跨域请求，而 script 标签 src 属性中的链接却可以访问跨域的 js 脚本，利用这个特性，服务端不再返回 JSON 格式的数据，而是返回一段调用某个函数的 js 代码，在 src 中进行了调用，这样实现了跨域。")]),t._v(" "),s("ul",[s("li",[t._v("当我们正常地请求一个 JSON 数据的时候，服务端返回的是一串 JSON 类型的数据，使用 JSONP 模式来请求数据的时候，服务端返回的是一段可执行的 JavaScript 代码。")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('使用JSONP，添加了一个script标签，标签的src指向了另一个域www.practice-zhao.com下的remote.js脚本\n<script type="text/javascript">\n    function jsonhandle(data){\n        alert("age:" + data.age + "name:" + data.name);\n    }\n<\/script>\n<script type="text/javascript" src="http://www.practice-zhao.com/remote.js"><\/script>\n\n\n//服务端\n\njsonhandle({\n    "age" : 15,\n    "name": "John",\n\n')])])]),s("p",[t._v("jsonp 缺点")]),t._v(" "),s("ul",[s("li",[t._v("jsonp 只支持 get 请求而不支持 post 请求")]),t._v(" "),s("li",[t._v("jsonp 只支持 get 请求，如果前端给后台传一个 json，后台是接收不到的，并且会报 415，如果前端要想把参数给后台，需要一个一个的拼。")]),t._v(" "),s("li",[t._v("存在安全风险，防止 callback 参数恶意添加 script 标签,造成 xss 漏洞")]),t._v(" "),s("li",[t._v("出现网络错误或者 404 等失败的回调函数并不会触发（通过 timeout 参数控制）")])]),t._v(" "),s("p",[t._v("jsonp 不是 ajax,ajax 是通过 XMLHttpRequest 对象发送异步请求，而 jsonp 则是利用 js 标签天生具备的跨域能力来实现跨域资源访问。也就是说，虽然它的名字叫 JSONP（JSON with Padding），但它底层是通过 js 标签实现的，它跟 json 以及普通异步请求关系都不大，jquery 之所以把 jsonp 请求放到 ajax 方法里面，只是为了让 api 更方便调用而已。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("//通过添加timeout设置请求超时，\n$.ajax({\n  url: '<%= SysUtils::TASK_CENTER_URL%>/all_tasks_h/verbose',\n  type: 'GET',\n  dataType: 'jsonp', // dataType为jsonp\n  timeout: 5000, // 添加timeout参数\n  success: function(data) { $('.result').text(JSON.stringify(data)); },\n  error: function(jqXHR, textStatus) {\n   // 此时textStatus为‘timeout’\n   $('#main-content').text('error'); alert('JSONP error!');\n  }\n});\n\n\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);